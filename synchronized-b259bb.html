<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>Synchronized&nbsp;|&nbsp;沂风</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Synchronized">
  
    <meta name="description" content="Synchnronized锁以及锁升级过程">
    <meta property="og:description" content="Synchnronized锁以及锁升级过程">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🕰️&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😀&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>关于</span>
        </div>
      </a>
    
  
    
  
    
  
</nav>
  <header class="Header">
    
      <div class="Header__Cover">
        <img src="https://www.notion.so/images/page-cover/rijksmuseum_avercamp_1620.jpg">
      </div>
    
    <div class="Header__Spacer ">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🕰️&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">Synchronized</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Tue, Sep 5, 2023</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--red">
            <a href="tag/JUC.html">JUC</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/b259bb8798804ba28cb8a46571c19d6b" class="PageRoot"><ul id="https://www.notion.so/1036bcec6ba54471994332c9b82296d8" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/70afd85e68dc4edbb31b3caa08cf1a0e"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">volatile与 Synchronized</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/37ac355405a14753b12f7b6c2c1a8658"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">volatile借助内存屏障来帮助其解决可见性和有序性问题</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/0110703c78784b078590f4a653d9af4f"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">synchronized的原理和特性</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/569831f252b8402484e04b59e12a8c4b"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">每个实例都对应有自己的一把锁(this),不同实例之间互不影响；例外：锁对象是*.class以及synchronized修饰的是static方法的时候，所有对象公用同一把锁</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ba432f194d804b29ba742d1acdb0cedf"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">synchronized修饰的方法，无论方法正常执行完毕还是抛出异常，都会释放锁</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ce7f85c2a75948e2b322ccc9579d3e88"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">并发三大问题</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/08fe023272004519a45390ced7670a6a"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">锁住的对象和作用范围</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ba9cf6deb9a84c7cb34404080c30f77a"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">代码块锁住：该对象/类的全部对象（Class对象）/（）中的对象</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9e5408661e644e61b22e19d848b8060e"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">修饰类/方法：类的全部对象（static方法）/该对象（普通方法）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/e568f4f785e94c3c8325d47951f14f6b"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">修饰一个代码块，被修饰的代码块称为同步语句块，其作用的范围是大括号{}括起来的代码，作用的对象是调用这个代码块的对象，锁住的对象是（）中的对象；</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/e6da5f43cd744ba1b8ade111ddae2ad5"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">修饰一个方法，被修饰的方法称为同步方法，其作用的范围是整个方法，作用的对象是调用这个方法的对象，锁住的对象是类的实例；</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/a0e375a81dd5402793463cd19e97ace1"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">修饰一个静态的方法，其作用的范围是整个静态方法，作用的对象是这个类的所有对象</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d08a3290412d4022810d53542c429e02"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">加锁和释放锁原理</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9d9039ac8ceb43789e8eba4b27f8baf1"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Monitorenter</code></span><span class="SemanticString">和</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Monitorexit</code></span><span class="SemanticString">指令，会让锁计数器加1或者减1。</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/a6f540442b3e48d3a0e8cce63050d7d5"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">每一个对象在同一时间只与一个monitor(锁)相关联，而一个monitor在同一时间只能被一个线程获得</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/2bf5a86fe13e45cbbdedd77aa0bf31f0"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">一个对象在尝试获得与这个对象相关联的Monitor锁的所有权的时候，monitorenter指令会发生如下3中情况之一：</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/74ca4c50ab24400084245d47c4a8d043"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">利用momitorenter指令抢占该对象的控制权，使该线程拥有控制权</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/da08e323decf4bb4a93da869314d5dae"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">针对可重入性：即在</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">同一锁程</strong></span><span class="SemanticString">中，每个对象拥有一个monitor计数器，当线程获取该对象锁后，monitor计数器就会加一，释放锁后就会将monitor计数器减一，线程不需要再次获取同一把锁。</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/6b3a6fed6c3a494682d18bbceae57c94"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">保证可见性的原理：内存模型和happens-before规则</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9fb40293320442db84aa5a7aef7c24ab"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">红色的为监视器锁规则推导而出：线程A释放锁happens-before线程B加锁，蓝色的则是通过程序顺序规则和监视器锁规则推测出来happens-befor关系，通过传递性规则进一步推导的happens-before关系。</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/7e2e43837df8449ab0f5c5461b550e7a"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">根据happens-before的定义中的一条:如果A happens-before B，则A的执行结果对B可见，并且A的执行顺序先于B。线程A先对共享变量A进行加一，由2 happens-before 5关系可知线程A的执行结果对线程B可见即线程B所读取到的a的值为1。</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/c0530cde8ab548f4800d169034a605c8"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">JVM锁的优化</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/6e4fa66fc7d740d3a05b636852695eb5"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">锁粗化</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/344a046f653f4dd2aa41ec904a649ba5"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">锁升级过程</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/c38d886b70204a61b7a430f3197bb542"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">采用对象打标机的模式，那么就只有在用户态之间切换，这样就提升了性能，避免了不必要的性能开销，这也就是synchronized在jdk1.6过后的锁优化达到的效果，也就是通过锁升级来实现的</strong></span><span class="SemanticString">。</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/7817f5d00587455d8973aa3d54b535c4"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Java对象结构</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5888216627904440906af667cb0c1cd2"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">轻量级锁</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/e43931627a824354bbb1b73efd88228a"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">
无锁-偏向锁</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4f7693fb3d31467ea66279fab1dfe678"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">偏向锁升级为轻量级锁</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/0cadd30dcbb04fa2965479e90e9029c5"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">轻量级锁升级为重量级锁</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/e4e2ab24bd974b1fa8ec26d257eadd99"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">参考资料</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/7977d814f286463d9a7f0810c568a67a"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">参考资料</span></span></div></a></li></ul><h1 id="https://www.notion.so/70afd85e68dc4edbb31b3caa08cf1a0e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/70afd85e68dc4edbb31b3caa08cf1a0e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">volatile与 Synchronized</span></span></h1><ol class="NumberedListWrapper"><li id="https://www.notion.so/c8c5e1cda04641388edc0b7fb89dc659" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">synchronized保证了三大性，原子性，有序性，可见性。volatile保证有序性，可见性，不能保证原子性</span></span></li><li id="https://www.notion.so/e27a07835f9943cc8fa545eda16ab530" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">volatile是线程同步的轻量级实现，性能比较好。但是只能用于变量</span></span></li><li id="https://www.notion.so/9639bf7e4d1c4137b95a73d55ebd460f" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">多线程访问volatile关键字 不会发生阻塞</span></span></li><li id="https://www.notion.so/de815908656e4765a646c02b5fd23325" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">volatile主要用于解决变量在多个线程之间的可见性</span></span></li></ol><h3 id="https://www.notion.so/37ac355405a14753b12f7b6c2c1a8658" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/37ac355405a14753b12f7b6c2c1a8658"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">volatile借助内存屏障来帮助其解决可见性和有序性问题</span></span></h3><h1 id="https://www.notion.so/0110703c78784b078590f4a653d9af4f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/0110703c78784b078590f4a653d9af4f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">synchronized的原理和特性</span></span></h1><h3 id="https://www.notion.so/569831f252b8402484e04b59e12a8c4b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/569831f252b8402484e04b59e12a8c4b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">每个实例都对应有自己的一把锁(this),不同实例之间互不影响；例外：锁对象是*.class以及synchronized修饰的是static方法的时候，所有对象公用同一把锁</span></span></h3><h3 id="https://www.notion.so/ba432f194d804b29ba742d1acdb0cedf" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/ba432f194d804b29ba742d1acdb0cedf"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">synchronized修饰的方法，无论方法正常执行完毕还是抛出异常，都会释放锁</span></span></h3><h2 id="https://www.notion.so/ce7f85c2a75948e2b322ccc9579d3e88" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/ce7f85c2a75948e2b322ccc9579d3e88"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">并发三大问题</span></span></h2><div id="https://www.notion.so/83513910677f40cc845f3424b11e8d2f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">保证原子性：</span></span></p></div><div id="https://www.notion.so/9128f62872ae4cf9bc48024b994a47a8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">同一时间只有一个线程操作，其他线程会被阻塞在外面</span></span></p></div><div id="https://www.notion.so/6fcccb0c55d548ecbc096a93716e37fd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">保证可见性：
进入synchronized块的内存语义是把在syn块内使用的变量从线程的工作内存中清除</span></span></p></div><div id="https://www.notion.so/90a4ca1550914afd998fae850dfd593a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">退出synchronized块的内存语义是把在syn块内对共享变量的修改刷新到主内存</span></span></p></div><div id="https://www.notion.so/49cd097e7e574f5596c81f709262af67" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">保证有序性：
利用同步代码块</span></span></p></div><h2 id="https://www.notion.so/08fe023272004519a45390ced7670a6a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/08fe023272004519a45390ced7670a6a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">锁住的对象和作用范围</span></span></h2><h3 id="https://www.notion.so/ba9cf6deb9a84c7cb34404080c30f77a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/ba9cf6deb9a84c7cb34404080c30f77a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">代码块锁住：该对象/类的全部对象（Class对象）/（）中的对象</span></span></h3><div id="https://www.notion.so/25c0e1cc258141b6a481030906df8bf7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h3 id="https://www.notion.so/9e5408661e644e61b22e19d848b8060e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/9e5408661e644e61b22e19d848b8060e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">修饰类/方法：类的全部对象（static方法）/该对象（普通方法）</span></span></h3><div id="https://www.notion.so/5d56d28f27ed45b1b2641b3aeb89f58c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F082abd92-c1c8-4bd2-be7d-c82686f65873%2FUntitled.png?width=1272&amp;table=block&amp;id=5d56d28f-27ed-45b1-b264-1b3aeb89f58c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F082abd92-c1c8-4bd2-be7d-c82686f65873%2FUntitled.png?width=1272&amp;table=block&amp;id=5d56d28f-27ed-45b1-b264-1b3aeb89f58c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/13924a3d8cee4624b4af321341f78815" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/4ab978b186f843a4969277606b952977" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F1f3a22db-6f25-4f9d-b449-d98a6e95a34f%2FUntitled.png?width=1272&amp;table=block&amp;id=4ab978b1-86f8-43a4-9692-77606b952977"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F1f3a22db-6f25-4f9d-b449-d98a6e95a34f%2FUntitled.png?width=1272&amp;table=block&amp;id=4ab978b1-86f8-43a4-9692-77606b952977" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/e568f4f785e94c3c8325d47951f14f6b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e568f4f785e94c3c8325d47951f14f6b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">修饰一个代码块，被修饰的代码块称为同步语句块，其作用的范围是大括号{}括起来的代码，作用的对象是调用这个代码块的对象，锁住的对象是（）中的对象；</span></span></h3><div id="https://www.notion.so/5690cb2acf024621acc15fa615caf716" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当两个并发线程访问同一个对象中的synchronized(this){}同步代码块时，同一时间内只能有一个线程得到执行。另一个线程必须等待当前线程执行完这个代码块以后才能执行该代码块；
当一个线程访问对象中的一个synchronized(this){}同步代码块时，另一个线程仍然可以访问该对象中的非synchronized(this){}同步代码块；
当一个线程访问对象中的一个synchronized(this){}同步代码块时，其他线程对对象中所有其它synchronized(this){}同步代码块的访问将被阻塞；</span></span></p></div><h3 id="https://www.notion.so/e6da5f43cd744ba1b8ade111ddae2ad5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e6da5f43cd744ba1b8ade111ddae2ad5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">修饰一个方法，被修饰的方法称为同步方法，其作用的范围是整个方法，作用的对象是调用这个方法的对象，锁住的对象是类的实例；</span></span></h3><div id="https://www.notion.so/1e1f651c91fd4b4c86811a0bee887e9d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">与上述类似</span></span></p></div><h3 id="https://www.notion.so/a0e375a81dd5402793463cd19e97ace1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/a0e375a81dd5402793463cd19e97ace1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">修饰一个静态的方法，其作用的范围是整个静态方法，作用的对象是这个类的所有对象</span></span></h3><div id="https://www.notion.so/dfa67178c04f48d687d3778cb50bb14d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/d08a3290412d4022810d53542c429e02" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/d08a3290412d4022810d53542c429e02"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">加锁和释放锁原理</span></span></h2><div id="https://www.notion.so/de0fa6602bb0446daa8ee84ba66ce104" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F74e47a97-04d8-403f-a5d6-efccbb7ea810%2FUntitled.png?width=1524&amp;table=block&amp;id=de0fa660-2bb0-446d-aa8e-e84ba66ce104"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F74e47a97-04d8-403f-a5d6-efccbb7ea810%2FUntitled.png?width=1524&amp;table=block&amp;id=de0fa660-2bb0-446d-aa8e-e84ba66ce104" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/9d9039ac8ceb43789e8eba4b27f8baf1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/9d9039ac8ceb43789e8eba4b27f8baf1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Monitorenter</code></span><span class="SemanticString">和</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Monitorexit</code></span><span class="SemanticString">指令，会让锁计数器加1或者减1。</span></span></h3><h3 id="https://www.notion.so/a6f540442b3e48d3a0e8cce63050d7d5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/a6f540442b3e48d3a0e8cce63050d7d5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">每一个对象在同一时间只与一个monitor(锁)相关联，而一个monitor在同一时间只能被一个线程获得</span></span></h3><h3 id="https://www.notion.so/2bf5a86fe13e45cbbdedd77aa0bf31f0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/2bf5a86fe13e45cbbdedd77aa0bf31f0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">一个对象在尝试获得与这个对象相关联的Monitor锁的所有权的时候，monitorenter指令会发生如下3中情况之一：</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/10b25368c402419199a5a48b43d4547e" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">• monitor计数器为0，意味着目前还没有被获得，那这个线程就会立刻获得然后把锁计数器+1，一旦+1，别的线程再想获取，就需要等待</span></span></li><li id="https://www.notion.so/5c5e528ff1754a9abc732db3e32a4eee" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">• 如果这个monitor已经拿到了这个锁的所有权，又重入了这把锁，那锁计数器就会累加，变成2，并且随着重入的次数，会一直累加</span></span></li><li id="https://www.notion.so/ec9bfecddb3c4bac90f96693fb350f6c" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">这把锁已经被别的线程获取了，等待锁释</span></span></li></ol><div id="https://www.notion.so/397f660e16a5464596802cb210efb98e" class="Image Image--PageWidth"><figure><a href="https://prod-files-secure.s3.us-west-2.amazonaws.com/97f60ed7-2f91-4328-9e16-bcc075d7c8a7/ef6665d4-d9cc-4a1a-9739-d7a14afe4070/Untitled.png?width=1105"><img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/97f60ed7-2f91-4328-9e16-bcc075d7c8a7/ef6665d4-d9cc-4a1a-9739-d7a14afe4070/Untitled.png?width=1105" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/74ca4c50ab24400084245d47c4a8d043" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/74ca4c50ab24400084245d47c4a8d043"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">利用momitorenter指令抢占该对象的控制权，使该线程拥有控制权</span></span></h3><h3 id="https://www.notion.so/da08e323decf4bb4a93da869314d5dae" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/da08e323decf4bb4a93da869314d5dae"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">针对可重入性：即在</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">同一锁程</strong></span><span class="SemanticString">中，每个对象拥有一个monitor计数器，当线程获取该对象锁后，monitor计数器就会加一，释放锁后就会将monitor计数器减一，线程不需要再次获取同一把锁。</span></span></h3><div id="https://www.notion.so/706fd03d04a54c3fab670f742590d803" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc8d35368-0fe7-4b36-8647-ff90b125ebe5%2FUntitled.png?width=1272&amp;table=block&amp;id=706fd03d-04a5-4c3f-ab67-0f742590d803"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc8d35368-0fe7-4b36-8647-ff90b125ebe5%2FUntitled.png?width=1272&amp;table=block&amp;id=706fd03d-04a5-4c3f-ab67-0f742590d803" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h2 id="https://www.notion.so/6b3a6fed6c3a494682d18bbceae57c94" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/6b3a6fed6c3a494682d18bbceae57c94"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">保证可见性的原理：内存模型和happens-before规则</span></span></h2><div id="https://www.notion.so/09cadef2d45646bfa4c865a6ef492556" class="Image Image--PageWidth"><figure><a href="https://prod-files-secure.s3.us-west-2.amazonaws.com/97f60ed7-2f91-4328-9e16-bcc075d7c8a7/4b7879d8-8ecd-442a-8a8e-25de1e5c3088/Untitled.png?width=941"><img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/97f60ed7-2f91-4328-9e16-bcc075d7c8a7/4b7879d8-8ecd-442a-8a8e-25de1e5c3088/Untitled.png?width=941" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/9fb40293320442db84aa5a7aef7c24ab" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/9fb40293320442db84aa5a7aef7c24ab"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">红色的为监视器锁规则推导而出：线程A释放锁happens-before线程B加锁，蓝色的则是通过程序顺序规则和监视器锁规则推测出来happens-befor关系，通过传递性规则进一步推导的happens-before关系。</span></span></h3><h3 id="https://www.notion.so/7e2e43837df8449ab0f5c5461b550e7a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/7e2e43837df8449ab0f5c5461b550e7a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">根据happens-before的定义中的一条:如果A happens-before B，则A的执行结果对B可见，并且A的执行顺序先于B。线程A先对共享变量A进行加一，由2 happens-before 5关系可知线程A的执行结果对线程B可见即线程B所读取到的a的值为1。</span></span></h3><div id="https://www.notion.so/449ca53d973b46dba870f5a5fd952676" class="Divider"></div><h2 id="https://www.notion.so/c0530cde8ab548f4800d169034a605c8" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/c0530cde8ab548f4800d169034a605c8"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">JVM锁的优化</span></span></h2><h3 id="https://www.notion.so/6e4fa66fc7d740d3a05b636852695eb5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/6e4fa66fc7d740d3a05b636852695eb5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">锁粗化</span></span></h3><div id="https://www.notion.so/653f21fc467641ae89378d2e06cb8347" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">也就是减少不必要的紧连在一起的unlock，lock操作，将多个连续的锁扩展成一个范围更大的锁。</span></span></p></div><h2 id="https://www.notion.so/344a046f653f4dd2aa41ec904a649ba5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/344a046f653f4dd2aa41ec904a649ba5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">锁升级过程</span></span></h2><h3 id="https://www.notion.so/c38d886b70204a61b7a430f3197bb542" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/c38d886b70204a61b7a430f3197bb542"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">采用对象打标机的模式，那么就只有在用户态之间切换，这样就提升了性能，避免了不必要的性能开销，这也就是synchronized在jdk1.6过后的锁优化达到的效果，也就是通过锁升级来实现的</strong></span><span class="SemanticString">。</span></span></h3><h3 id="https://www.notion.so/7817f5d00587455d8973aa3d54b535c4" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/7817f5d00587455d8973aa3d54b535c4"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Java对象结构</span></span></h3><div id="https://www.notion.so/e11cb6ee67d1407682bede55adda8acc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">。在对象头中(</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Object Header</code></span><span class="SemanticString">)存在两部分。第一部分用于存储对象自身的运行时数据，</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">HashCode</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">GC Age</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">锁标记位</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">是否为偏向锁</code></span><span class="SemanticString">等——Mark Word</span></span></p></div><div id="https://www.notion.so/439420937dcf4b81a2983a3a21944610" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">另外一部分存储的是指向方法区对象类型数据的指针(</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Klass Point</code></span><span class="SemanticString">)，如果对象是数组的话，还会有一个额外的部分用于存储数据的长度。</span></span></p></div><div id="https://www.notion.so/44aca72a9175430a8fbbc57619c0cb07" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F414fef37-eb03-4231-8879-c3adf3c74e16%2FUntitled.png?width=1442&amp;table=block&amp;id=44aca72a-9175-430a-8fbb-c57619c0cb07"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F414fef37-eb03-4231-8879-c3adf3c74e16%2FUntitled.png?width=1442&amp;table=block&amp;id=44aca72a-9175-430a-8fbb-c57619c0cb07" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/5888216627904440906af667cb0c1cd2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/5888216627904440906af667cb0c1cd2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">轻量级锁</span></span></h3><div id="https://www.notion.so/966c1a69352c4479a865f4177ed14777" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">它可以减少重量级锁对线程的阻塞带来的线程开销。从而提高并发性能。</span></span></p></div><div id="https://www.notion.so/8d0b2f3e249e49c1854c3a72098b0f27" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h3 id="https://www.notion.so/e43931627a824354bbb1b73efd88228a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e43931627a824354bbb1b73efd88228a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">
无锁-偏向锁</span></span></h3><div id="https://www.notion.so/cf50cf79b26a4d1593fdffb7429f90bd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">偏向锁的存在就是为了减少申请锁的繁杂的步骤</span></span></p></div><div id="https://www.notion.so/b8b7f9c4e64b460bb8425968464b9fa7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当一个线程访问同步块并获取锁时，会在对象头和栈帧中的所记录里存储锁偏向的线程ID，以后线程再进入同步块时只需要简单判断下对象头的Mark Word里是否记录着指向当前线程的偏向锁</span></span></p></div><div id="https://www.notion.so/fc6c7229605340a7ab50c515c9f1e1bf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">会有一次CAS修改MarkDown中ThreadId的操作</span></span></p></div><div id="https://www.notion.so/458b775c74eb41f5971c74041bda046c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0439e23f-16fc-4dde-8471-85c183d0aed6%2FUntitled.png?width=1588&amp;table=block&amp;id=458b775c-74eb-41f5-971c-74041bda046c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0439e23f-16fc-4dde-8471-85c183d0aed6%2FUntitled.png?width=1588&amp;table=block&amp;id=458b775c-74eb-41f5-971c-74041bda046c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><details id="https://www.notion.so/d4614a0246c04f12ac198070aad404ce" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle Toggle--Empty"><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">初始的状态是无锁的， 线程进来，状态为偏向锁，修改对象头的markdown</span></span></summary><div class="Toggle__Content"></div></details><details id="https://www.notion.so/7dbb0fc957cc4cae82ccd78cdf827926" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle Toggle--Empty"><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">再来其他的线程 ，CAS失败就要进入锁升级过程了（当然，初始线程退出，CAS就成功了）</span></span></summary><div class="Toggle__Content"></div></details><h3 id="https://www.notion.so/4f7693fb3d31467ea66279fab1dfe678" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/4f7693fb3d31467ea66279fab1dfe678"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">偏向锁升级为轻量级锁</span></span></h3><div id="https://www.notion.so/f8be000d0981463cb4d62c5b0155a398" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">其他线程来竞争，会尝试使用CAS将对象头中的Mark Word替换的线程ID替换为自己的，成功了维持偏向锁。</span></span></p></div><div id="https://www.notion.so/b3b4ccaaead84fdfa2a5b030d467a810" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">失败了就表示发生竞争，升级为轻量级锁</span></span></p></div><div id="https://www.notion.so/55dd6d3165ec45498b392dc38c85a138" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">然后继续CAS操作，尝试将Mark Word修改为指向本线程锁记录的指针</span></span></p></div><div id="https://www.notion.so/810c48d2edf04da9916d3c983b626583" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">成功，就表示获得了锁，失败就利用自旋继续操作</span></span></p></div><details id="https://www.notion.so/fa6742c539db4136bd1dad62959aa9a3" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle Toggle--Empty"><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">升级过程非常消耗性能</span></span></summary><div class="Toggle__Content"></div></details><div id="https://www.notion.so/6afec54644814af79375d6c2c6dcce15" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2093e607-f6de-4f28-8e4a-3a5b3e44f6af%2FUntitled.png?width=1644&amp;table=block&amp;id=6afec546-4481-4af7-9375-d6c2c6dcce15"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2093e607-f6de-4f28-8e4a-3a5b3e44f6af%2FUntitled.png?width=1644&amp;table=block&amp;id=6afec546-4481-4af7-9375-d6c2c6dcce15" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/0cadd30dcbb04fa2965479e90e9029c5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/0cadd30dcbb04fa2965479e90e9029c5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">轻量级锁升级为重量级锁</span></span></h3><details id="https://www.notion.so/a1e51d64949d46e08e20ecd2c238a1a3" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle Toggle--Empty"><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">线程1首先将在线程栈上开辟一定的空间来存储mark word，并且相互指向，然后开始执行同步代码，而这个时候很多线程都过来了，那么这些线程也要拷贝markword到线程栈中，然后cas修改lock record与mark word的相互指向，这个时候只有一个线程能够成功，其他线程都需要cas，如果线程1没有同步代码块没有指</span></span></summary><div class="Toggle__Content"></div></details><details id="https://www.notion.so/45178f8ef72f4928a4916bfdc3d3a1b4" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle Toggle--Empty"><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">CAS一定次数还是失败，大致上锁就会升级成为重量级锁</span></span></summary><div class="Toggle__Content"></div></details><div id="https://www.notion.so/4c849eaac4b74af6b777a344729825c4" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6f39a85e-d742-4b37-b63b-fe8779be669b%2FUntitled.png?width=1668&amp;table=block&amp;id=4c849eaa-c4b7-4af6-b777-a344729825c4"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6f39a85e-d742-4b37-b63b-fe8779be669b%2FUntitled.png?width=1668&amp;table=block&amp;id=4c849eaa-c4b7-4af6-b777-a344729825c4" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/5c51560005d942688e876beab4b95f27" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fccfdaf99-1439-4c7a-b782-98b9b4bc84b8%2FUntitled.png?width=1556&amp;table=block&amp;id=5c515600-05d9-4268-8e87-6beab4b95f27"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fccfdaf99-1439-4c7a-b782-98b9b4bc84b8%2FUntitled.png?width=1556&amp;table=block&amp;id=5c515600-05d9-4268-8e87-6beab4b95f27" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/90c462166ec442dc930ce9f8ef8ac231" class="Image Image--PageWidth"><figure><a href="https://prod-files-secure.s3.us-west-2.amazonaws.com/97f60ed7-2f91-4328-9e16-bcc075d7c8a7/29b6ba93-b4e9-4099-8777-709649163499/Untitled.png?width=1211"><img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/97f60ed7-2f91-4328-9e16-bcc075d7c8a7/29b6ba93-b4e9-4099-8777-709649163499/Untitled.png?width=1211" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/e4e2ab24bd974b1fa8ec26d257eadd99" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e4e2ab24bd974b1fa8ec26d257eadd99"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">参考资料</span></span></h3><div id="https://www.notion.so/392d5446aa2c4d4481cae00e90f4d2ee" class="Bookmark"><a href="https://www.cnblogs.com/suixing123/p/13996479.html"><h5 class="Bookmark__Title">synchronized锁升级详细过程 - 随心的风 - 博客园</h5><p class="Bookmark__Desc">copy:&amp;#160;http://www.voycn.com/article/synchronizedxiangxijieshaozhisuoshengjiguocheng 前言 我们在并发编程过程</p><p class="Bookmark__Link">https://www.cnblogs.com/suixing123/p/13996479.html</p></a></div><div id="https://www.notion.so/e44f281d6b264319b175adcc1f1180c0" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc44fb870-f21e-402e-b725-e169b981b751%2FUntitled.png?width=1272&amp;table=block&amp;id=e44f281d-6b26-4319-b175-adcc1f1180c0"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc44fb870-f21e-402e-b725-e169b981b751%2FUntitled.png?width=1272&amp;table=block&amp;id=e44f281d-6b26-4319-b175-adcc1f1180c0" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/b7d1022b643d41f6985b8e013fe0b544" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/7977d814f286463d9a7f0810c568a67a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/7977d814f286463d9a7f0810c568a67a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">参考资料</span></span></h2><div id="https://www.notion.so/91c63fb789464cb1832d12959d7a6d31" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">syn与单例模式</span></span></p></div><div id="https://www.notion.so/c293b2feb33542909d3702182c2049f1" class="Bookmark"><a href="https://www.cnblogs.com/meet/p/5290948.html"><h5 class="Bookmark__Title">线程的同步之Synchronized在单例模式中的应用 - FangZheng - 博客园</h5><p class="Bookmark__Desc">synchronized在单例模式中的使用在单例模式中有一种懒汉式的单例，就是类初始化的时候不创建对象。等第一次获取的时候再创建对象。这种单例在单线程下是没有问题的获取的也都是同一个对象。但是如果放入</p><p class="Bookmark__Link">https://www.cnblogs.com/meet/p/5290948.html</p></a></div></article>
  <footer class="Footer">
  <div>&copy; 沂风 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>